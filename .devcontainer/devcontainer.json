{
	"name": "Relora Dev",
	"build": {
		"context": "..",
		"dockerfile": "../Dockerfile",
		"target": "dev"
	},
	"runArgs": [
		// give headspace for pytorch dataloaders passing tensors across processes
		"--shm-size=1gb"
	],
	"containerEnv": {
		"DOCKER_BUILDKIT": "1",
		// The following are required to use MLFlow, Azure Blob Storage, and AML on GCR. Otherwise, it will default to
		// using a managed identity, which is does not have the necessary permissions.
		// This prevents IMDS managed identities which seem to be the default on GCR.
		"AZURE_POD_IDENTITY_AUTHORITY_HOST": "100::"
	},
	"mounts": [
		"source=command_history,target=/root/command_history,type=volume",  // Persist command history across instances
		"target=/root/.vscode-server,type=volume",  // Persist vscode server across instances
		"source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"  // Forward docker (Docker-out-of-Docker)
	],
	"hostRequirements": {
		"gpu": "optional"  // Add GPU if available
	},
	"postCreateCommand": "bash ${localWorkspaceFolder}/.devcontainer/post-create.sh",
	"postStartCommand": "poetry install",
	"shutdownAction": "none",
	"customizations": {
		"vscode": {
			"settings": {
				// General
				"editor.rulers": [120],
				"terminal.integrated.profiles.linux": {
					"zsh": {"path": "/usr/bin/zsh"}
				},
				"terminal.integrated.defaultProfile.linux": "zsh",

				// Python
				"[python]": {
					"editor.defaultFormatter": "ms-python.black-formatter"
				},
				"python.defaultInterpreterPath": "/usr/bin/python",
				"python.testing.pytestEnabled": true,
				"python.testing.pytestArgs": [
					"--continue-on-collection-errors",
				],
				"python.testing.unittestEnabled": false,

			},
			"extensions": [
				"bungcip.better-toml",
				"github.copilot",
				"github.copilot-chat",
				"github.copilot-labs",
				"ms-azuretools.vscode-docker",
				"ms-python.black-formatter",
				"ms-python.isort",
				"ms-python.pylint",
				"ms-python.python",
				"ms-python.vscode-pylance",
				"ms-toolsai.jupyter",
				"redhat.vscode-yaml",
				"vscodevim.vim"
			]
		}
	}
}
